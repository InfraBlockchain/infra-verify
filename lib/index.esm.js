import{decodeJWT as e}from"did-jwt";import{verifyPresentation as r,verifyCredential as t}from"did-jwt-vc";import{Resolver as n}from"did-resolver";import{getResolver as i}from"infra-did-resolver";import o from"infra-did-js";function s(){return(s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var a=function(){function a(e){this.resolver=e.resolver?e.resolver:new n(i(e.networkConfig)),this.did=e.did?e.did:o.createPubKeyDIDsecp256k1("01").did,this.challenge="",this.knownIssuer=e.knownIssuer}var u=a.prototype;return u.ready=function(){return this.challenge=this.generateChallenge(),{challenge:this.challenge,aud:this.did}},u.generateChallenge=function(){return o.createPubKeyDIDsecp256k1("01").did},u.getVPClaims=function(r){var t=this;return e(r).payload.vp.verifiableCredential.map(function(e){return t.getVCClaims(e)}).reduce(function(e,r){return s({},r,e)},{})},u.getVCClaims=function(r){return e(r).payload.vc.credentialSubject},u.isValid=function(r){try{var t=e(r);if(t.payload.vp)return Promise.resolve(this.isValidVP(r));if(t.payload.vc)return Promise.resolve(this.isValidVC(r));throw new Error("Unsupported type")}catch(e){return Promise.reject(e)}},u.isValidVP=function(e){try{var t=this;return Promise.resolve(r(e,t.resolver,{challenge:t.challenge,audience:t.did})).then(function(e){var r=e.payload.vp.VerifiedCredential,n=e.payload.signer;if(t.isRevoked(n.did))throw new Error("Deactivated Presenter");return r.map(function(e){return t.isValidVC(e,n.did)},t).reduce(function(e,r){return e&&r},!0)})}catch(e){return Promise.reject(e)}},u.isValidVC=function(e,r){try{var n=this;return Promise.resolve(t(e,n.resolver)).then(function(e){if(r&&e.payload.sub!==r)throw new Error("Signer is not the subject of VC");if(n.isKnownIssuer(e.issuer))throw new Error("Unknown Issuer");if(n.isRevoked(e.issuer))throw new Error("Deactivated Issuer");if(n.isRevoked(e.payload.vc.id))throw new Error("Revoked VC");return!0})}catch(e){return Promise.reject(e)}},u.isRevoked=function(e){try{return Promise.resolve(this.resolver.resolve(e)).then(function(e){return!!e.didDocumentMetadata.deactivated})}catch(e){return Promise.reject(e)}},u.isKnownIssuer=function(e){for(var r in this.knownIssuer)if(this.knownIssuer[r]===e)return!0;return!1},a}();export default a;
//# sourceMappingURL=index.esm.js.map
