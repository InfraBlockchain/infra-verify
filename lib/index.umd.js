!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("did-jwt-vc"),require("infra-did-resolver"),require("infra-did-js")):"function"==typeof define&&define.amd?define(["did-jwt-vc","infra-did-resolver","infra-did-js"],r):(e=e||self).infraVerifyJs=r(e.didJwtVc,e.infraDidResolver,e.infraDidJs)}(this,function(e,r,t){function n(){return(n=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function i(e,r){return r()}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;const o=new RegExp("^did:([a-zA-Z0-9_]+):([a-zA-Z0-9_.%-]+(:[a-zA-Z0-9_.%-]+)*)((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$");function s(e){if(""===e||!e)return null;const r=e.match(o);if(r){const t={did:`did:${r[1]}:${r[2]}`,method:r[1],id:r[2],didUrl:e};if(r[4]){const e=r[4].slice(1).split(";");t.params={};for(const r of e){const e=r.split("=");t.params[e[0]]=e[1]}}return r[6]&&(t.path=r[6]),r[7]&&(t.query=r[7].slice(1)),r[8]&&(t.fragment=r[8].slice(1)),t}return null}const a={didResolutionMetadata:{},didDocument:null,didDocumentMetadata:{}};function d(e){return async(r,t,i)=>{try{const o=await e(r,t,i);return n({},a,{didResolutionMetadata:{contentType:"application/did+ld+json"},didDocument:o})}catch(e){return n({},a,{didResolutionMetadata:{error:"notFound",message:e.toString()}})}}}class c{constructor(e={},r={}){this.registry=e,this.cache=!0===r.cache?function(){const e=new Map;return async(r,t)=>{var n;if(r.params&&"true"===r.params["no-cache"])return await t();const i=e.get(r.didUrl);if(void 0!==i)return i;const o=await t();return"notFound"!==(null==(n=o.didResolutionMetadata)?void 0:n.error)&&e.set(r.didUrl,o),o}}():r.cache||i,r.legacyResolvers&&Object.keys(r.legacyResolvers).map(e=>{this.registry[e]||(this.registry[e]=d(r.legacyResolvers[e]))})}async resolve(e,r={}){const t=s(e);if(null===t)return n({},a,{didResolutionMetadata:{error:"invalidDid"}});const i=this.registry[t.method];return i?this.cache(t,()=>i(t.did,t,this,r)):n({},a,{didResolutionMetadata:{error:"unsupportedDidMethod"}})}}return function(){function n(e){this.resolver=e.resolver?e.resolver:new c(r.getResolver(e.networkConfig)),this.did=e.did?e.did:t.createPubKeyDIDsecp256k1("01").did,this.knownIssuer=e.knownIssuer}var i=n.prototype;return i.ready=function(){return this.challenge=this.generateChallenge(),{challenge:this.challenge,aud:this.did}},i.generateChallenge=function(){return t.createPubKeyDIDsecp256k1("01").did},i.isValidVP=function(r){try{var t=this;return Promise.resolve(e.verifyPresentation(r,t.resolver,{challenge:t.challenge,audience:t.did})).then(function(e){var r=e.payload.vp.VerifiedCredential,n=e.payload.signer;if(t.isRevoked(n.did))throw new Error("Deactivated Presenter");return r.map(function(e){return t.isValidVC(e,n.did)},t).reduce(function(e,r){return e&&r},!0)})}catch(e){return Promise.reject(e)}},i.isValidVC=function(r,t){try{var n=this;return Promise.resolve(e.verifyCredential(r,n.resolver)).then(function(e){if(t&&e.payload.sub!==t)throw new Error("Signer is not the subject of VC");if(n.isKnownIssuer(e.issuer))throw new Error("Unknown Issuer");if(n.isRevoked(e.issuer))throw new Error("Deactivated Issuer");if(n.isRevoked(e.payload.vc.id))throw new Error("Revoked VC");return!0})}catch(e){return Promise.reject(e)}},i.isRevoked=function(e){try{return Promise.resolve(this.resolver.resolve(e)).then(function(e){return!!e.didDocumentMetadata.deactivated})}catch(e){return Promise.reject(e)}},i.isKnownIssuer=function(e){for(var r in this.knownIssuer)if(this.knownIssuer[r]===e)return!0;return!1},n}()});
//# sourceMappingURL=index.umd.js.map
